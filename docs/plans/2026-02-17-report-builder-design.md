# Report Builder — Design Document

**Date:** 2026-02-17
**Status:** Approved

## Problem

Export capabilities are scattered across 5+ locations in the app — PNG/Visio from the export bar, Terraform/CloudFormation from IaC modals, compliance CSV/HTML/Excel from the compliance export modal, BUDR CSV/JSON/XLSX from the BUDR dashboard, and policy exports from the compliance dashboard. There is no way to compose a unified assessment report combining data from multiple sources.

## Approach

**Modular Report Engine** — each report section is a self-contained render module (a function that takes app state and returns an HTML fragment). A full-screen report builder UI lets users toggle, reorder, and preview modules before generating a single self-contained HTML report file.

## Report Modules

Each module follows this interface:

```js
{
  id: string,
  name: string,
  icon: string,
  category: string,
  enabled: boolean,            // default on/off
  available: () => boolean,    // false = grayed out (no data)
  render: (ctx, options) => string  // returns HTML <section>
}
```

Seven modules:

| Module | Data Source | Renders |
|--------|-----------|---------|
| Executive Summary | `_rlCtx`, compliance/BUDR counts | Account overview, resource counts, posture score, risk heatmap |
| Architecture Diagram | SVG canvas capture | Embedded base64 PNG of current map |
| Compliance Findings | `_complianceFindings` | Per-framework tables with severity, control, remediation |
| BUDR Assessment | `_budrAssessments`, `_budrFindings` | Tier summary, RTO/RPO table, protection gaps |
| Resource Inventory | `_rlCtx` | Grouped table of VPCs, subnets, instances, DBs, etc. |
| Action Plan | `_complianceFindings` + `_budrFindings` | Prioritized remediation roadmap with effort tiers |
| IaC Recommendations | Terraform/CF generators | Code snippets for top remediations |

## UI Layout

Full-screen overlay (same z-index pattern as BUDR/compliance dashboards). Two-column layout:

**Left column (30%) — Section Picker:**
- Draggable cards (grip handle + checkbox + icon + name)
- Each card shows preview count ("12 findings", "6 resources assessed")
- Grayed out with "No data" when `available()` returns false
- Quick presets at top: "Full Assessment", "Compliance Only", "BUDR Only"

**Right column (70%) — Live Preview:**
- Scrollable preview of composed report
- Updates in real-time as sections are toggled/reordered
- Report metadata fields at top: Title, Author/Org, Date, optional logo upload

**Footer:** "Generate Report" button downloads the self-contained HTML file.

**Entry points:**
- Dock bar "Reports" button (rewired from current behavior)
- `Shift+R` keyboard shortcut
- Escape to close

## HTML Report Output

Single self-contained HTML file, no external dependencies:

```html
<!DOCTYPE html>
<html>
<head><style>/* All CSS inline */</style></head>
<body>
  <header>  <!-- Title, author, date, optional logo -->
  <nav>     <!-- Auto-generated table of contents -->
  <main>
    <section>...</section>  <!-- Only enabled sections -->
  </main>
  <footer>  <!-- Generated by AWS Mapper, timestamp -->
</body>
</html>
```

**Styling:**
- Dark theme matching app aesthetic (navy/slate palette)
- `@media print` override for white background / clean PDF printing
- Severity/tier color coding consistent with app
- Architecture diagram as base64 PNG `<img>`
- `page-break-before: always` on sections for PDF printing
- Expected file size: under 2-3MB

## Integration & Migration

| Current Export | Action |
|---|---|
| Compliance "Export Report" modal | Absorbed as Compliance module; old modal stays for quick exports |
| BUDR CSV/JSON/XLSX buttons | Stay in BUDR footer; BUDR becomes composable report section |
| Export bar (PNG/Visio/TF/CF) | Stay as one-click exports; diagram embeddable in report |
| Policy exports (CLI/Config/Rego/Checkov) | Stay as-is; developer-focused, not report material |

No breaking changes — all existing quick-export buttons remain. Report builder is additive.
